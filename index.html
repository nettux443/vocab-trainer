<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<style>
body {
    font-family: sans-serif;
}
#q {
    text-align: center;
    width: 95%
    padding: 5vh 0 5vh 0;
    font-size: 4em;
}
.correct {
    background-color: #3f3;
}
.incorrect {
    background-color: #f33;
}
.ans {
    font-size: 4em;
    display: inline-block;
    float: left;
    width: 45vw;
    height: 45vh;
    text-align: center;
    vertical-align: middle;
}
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js">
</script>
<script src="./terms.js">
</script>
<script>


function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

function getQuestion() {
    var terms = Array();
    var options = $("#opts input[type=checkbox]:checkbox:checked");
    for (opt of options) {
        console.log(opt.value);
        terms = terms.concat(term_list[opt.value]);
    }
    //var terms = term_list.basic.concat(term_list.work.concat(term_list.family.concat(term_list.active.concat(term_list.colours.concat(term_list.food.concat(term_list.body.concat(term_list.weather.concat(term_list.clothes.concat(term_list.time.concat(term_list.directions))))))))));
    var q = terms[Math.floor(Math.random() * terms.length)];
    var bad1 = terms[Math.floor(Math.random() * terms.length)];
    var bad2 = terms[Math.floor(Math.random() * terms.length)];
    var bad3 = terms[Math.floor(Math.random() * terms.length)];
    return [q,bad1,bad2,bad3];
}

function resetQuestion() {
    var question = getQuestion();
    $("#q").text(question[0].english);
    $("#q").attr("pinyin", question[0].pinyin);
    $("#q").attr("chinese", question[0].chinese);
    var answers = shuffle([question[0], question[1], question[2], question[3]]);
    var boxes = ["a0", "a1", "a2", "a3"];
    var i = 0;
    boxes.forEach(function(e) {
        var box = $("#"+e);
        box.removeClass("correct");
        box.removeClass("incorrect");
        box.html(answers[i].pinyin + "<br/>" + answers[i].chinese);
        box.attr("english", answers[i].english);
        box.attr("chinese", answers[i].chinese);
        i = i + 1;
    });
}

$( document ).ready(function() {
    var options_html = "<ul>";
    const iterator = term_list.keys();
    for (const key of Object.keys(term_list))  {
        options_html = options_html + "<li><input type='checkbox' value='" + key + "'checked/>" + key + "</li>";
    }
    options_html = options_html + "</ul>";
    $("#opts").html(options_html);
    $("#opts").hide();

    resetQuestion();

    $(".ans").on('click', function() {
        var correct = $("#q");
        if ($(this).attr("chinese") == correct.attr("chinese")) {
            $(this).addClass("correct");
        } else {
            $(this).addClass("incorrect");
        }
        setTimeout(resetQuestion, 500);
    });

    $("#toggle-opts").click(function() {
        $("#opts").toggle();
    });

});


</script>
</head>
<body>
<button id='toggle-opts'>Options</button>
<div id='opts'></div>
<div id='q'></div>
<div class='ans' id='a0'></div>
<div class='ans' id='a1'></div>
<div class='ans' id='a2'></div>
<div class='ans' id='a3'></div>
</body>

</html>
